<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="../img/logo.png">
    <link href='https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="css/editrecord.css">
    <link rel="stylesheet" href="css/logout.css">
    <title>Visit Information</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
</head>

<body>

    <section id="sidebar">
        <a href="#" class="brand">
            <img src="../img/logo.png" alt="RHULogo" class="logo">
            <span class="text">Hello Physician</span>
        </a>
        <ul class="side-menu top">
            <li>
                <a href="dashboard.html">
                    <i class="bx bxs-dashboard"></i>
                    <span class="text">Dashboard</span>
                </a>
            </li>
            <li>
				<a href= "ITR.html">
					<i class="bx bxs-user"></i>
					<span class="text">Add New ITR</span>
				</a>
			</li>
            <li>
                <a href="ITR.html">
                    <i class="bx bxs-user"></i>
                    <span class="text">Add New ITR</span>
                </a>
            </li>
            <li>
                <a href="searchPatient.html">
                    <i class="bx bxs-notepad"></i>
                    <span class="text">Patient Records</span>
                </a>
            </li>
            <li>
                <a href="history.html">
                    <i class="bx bx-history"></i>
                    <span class="text">Referral History</span>
                </a>
            </li>
            <li>
				<a href="reports.html">
					<i class="bx bx-notepad"></i>
					<span class="text">Reports</span>
				</a>
			</li>
        </ul>
        <ul class="side-menu">
            <li>
                <a href="#" class="logout" onclick="return confirmLogout()">
               <i class="bx bxs-log-out-circle"></i>
                <span class="text">Logout</span>
                </a>

            </li>
        </ul>
    </section> 

    <section id="content">
        <nav>
			<form action="#">
				
			</form>
			<div class="greeting">
                <span id="userGreeting">Hello RHU Physician!</span>
            </div>
			<a href="#" class="profile">
				<img src="../img/doctor.png">
			</a>
		</nav>

        <main>
            <div class="head-title">
			</div>


    <div class="container-header">
        <h2>VISIT DETAILS</h2>
    </div>
    <div class="container">
     
        
         <!-- INITIAL ASSESSMENT / VISIT INFO -->
<div class="additional-group box-group additional-fields">
    <div class="additional-options">
        <div class="form-row">
            <div class="form-group">
                <label>Patient Alert:</label>
                <input type="text" class="patient-alert form-control" name="patient_alert" value="N/A">
            </div>
        </div>

        <div class="form-row">
            <div class="form-group" style="font-weight: bold;">
                <label>Date of Visit:</label>
                <input type="date" class="visit-date form-control" name="visit_date">
            </div>
        </div>

        <div class="form-row">
            <div class="form-group" style="font-weight: bold;">
                <label>Chief Complaints:</label>
                <textarea class="chief-complaints form-control" name="chief_complaints">N/A</textarea>
            </div>
        </div>

        <div class="form-row">
            <label for="vitals"><b>Vital Signs:</b></label>
            <div class="vitals-section">
                <div class="form-group" style="font-weight: bold;">
                    <label>Blood Pressure (mm Hg):</label>
                    <input type="text" class="blood-pressure form-control"  name="blood_pressure" value="N/A">
                </div>
                <div class="form-group" style="font-weight: bold;">
                    <label>Temperature (°C):</label>
                    <input type="number" step="0.1" class="temperature form-control"  name="temperature" value="N/A">
                </div>
                <div class="form-group" style="font-weight: bold;">
                    <label>Weight (kg):</label>
                    <input type="number" step="0.1" class="weight form-control"  name="weight" value="N/A">
                </div>
                <div class="form-group" style="font-weight: bold;">
                    <label>Height (cm):</label>
                    <input type="number" step="0.1" class="height form-control"  name="height" value="N/A">
                </div>
                <div class="form-group" style="font-weight: bold;">
                    <label>Pulse Rate (per minute):</label>
                    <input type="number" class="chest-rate form-control"  name="chest_rate" value="N/A">
                </div>
                <div class="form-group" style="font-weight: bold;">
                    <label>Respiratory Rate (per minute):</label>
                    <input type="number" class="respiratory-rate form-control"  name="respiratory_rate" value="N/A">
                </div>
            </div>
        </div>
        <div class="form-row">
            <div class="form-group" style="font-weight: bold;">
                <label>Remarks:</label>
                <textarea class="remarks form-control" name="remarks">N/A</textarea>
            </div>
        </div>
    </div>
</div>



<form class="personal-info-form" id="individualRecordForm" action="php/updateConsultation.php" method="POST">
    <div class="additional-group box-group additional-fields" style="background-color: aliceblue;">
        
        <div class="additional-options">
            <!-- jQuery (required) -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!-- Select2 CSS -->
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />

<!-- Select2 JS -->
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<div class="form-group">
<label for="diagnosis">Diagnosis:</label>
<input name="diagnosis" id="diagnosis" class="diagnosis">

</div>


<div class="form-group">

    <div id="medicine-container">
        <div class="medicine-entry">
            <div class="form-group"> 
                <label for="medicine_given[]">Medicine Given:</label>
                <input name="medicine_given[]" class="medicine-given"> 
            </div>

            <div class="quantity-section">
                <div class="form-group">
                    <label for="quantity_given[]">Quantity:</label>
                    <div class="quantity-container">
                        <button type="button" class="btn-minus">−</button>
                        <input type="number" name="quantity_given[]" value="0" min="0" class="quantity-given">
                        <button type="button" class="btn-plus">+</button>
                    </div>
                </div>
                <button type="button" class="remove-medicine">Remove</button>
            </div>
        </div>
    </div>

    <div class="add-medicine-container">
        <button type="button" id="add-medicine" class="add-medicine">+ Add</button>
    </div>

    <div id="medicine-template" style="display: none;">
        <div class="medicine-entry">
            <div class="form-group"> 
                <label>Medicine Given:</label>
                <input name="medicine_given[]" class="medicine-given"> 
            </div>
    
            <div class="quantity-section">
                <div class="form-group">
                    <label>Quantity:</label>
                    <div class="quantity-container">
                        <button type="button" class="btn-minus">−</button>
                        <input type="number" name="quantity_given[]" value="0" min="0" class="quantity-given">
                        <button type="button" class="btn-plus">+</button>
                    </div>
                </div>
                <button type="button" class="remove-medicine">Remove</button>
            </div>
        </div>
    </div>
    

    <script>
        document.getElementById("add-medicine").addEventListener("click", function () {
            const container = document.getElementById("medicine-container");
            const template = document.querySelector("#medicine-template .medicine-entry");
            const newEntry = template.cloneNode(true);
    
            // Reset values
            newEntry.querySelector(".medicine-given").value = "";
            newEntry.querySelector(".quantity-given").value = "0";
    
            container.appendChild(newEntry);
            container.scrollIntoView({ behavior: 'smooth', block: 'end' });
        });
    
        document.addEventListener("click", function (event) {
            if (event.target.classList.contains("btn-plus")) {
                const input = event.target.previousElementSibling;
                input.value = parseInt(input.value) + 1;
            } else if (event.target.classList.contains("btn-minus")) {
                const input = event.target.nextElementSibling;
                if (parseInt(input.value) > 0) {
                    input.value = parseInt(input.value) - 1;
                }
            } else if (event.target.classList.contains("remove-medicine")) {
                const entry = event.target.closest(".medicine-entry");
                entry.remove();
            }
        });
    </script>
    
</div>

            <div class="form-group">
                <label for="instruction">Instructions/Remarks:</label>
                <textarea type="text" name="instruction" placeholder="Enter your instructions and remarks"  class="instruction"></textarea>
            </div>

            <input type="hidden" id="visitIdField" name="visit_id">
            <input type="hidden" name="doctor_id" id="doctor_id" value="1">

            </div> </div>
    

    <div class="button-container">
        
   
        <button type="submit" class="submit-btn" id="submitButton">Submit</button>
    </div>
    
<div id="myModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <img src="../img/verify.png" alt="Checkmark" class="checkmark-image">
            <h3>Confirmation</h3>
            <span class="close-btn" id="closeBtn">&times;</span>
        </div>
        <div class="modal-body">
            <p>Save patient record?
        </div>
        
        <div class="modal-footer">
            <button id="cancelButton" class="btn no">Cancel</button>
            <button id="yesButton" class="btn yes">Save</button>
        </div>

    </div>
</div>





<br>
<input type="hidden" id="visitIdField" name="visit_id">
<input type="hidden" id="referralInput" />
<input type="hidden" id="user_id" name="user_id">

</div>
</form>
        </main>
    </section>


<div id="myModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <img src="../img/verify.png" alt="Checkmark" class="checkmark-image">
            <h3>Confirmation</h3>
            <span class="close-btn" id="closeBtn">&times;</span>
        </div>
        <div class="modal-body">
            <p>Update Individual Treatment Record?</p> 
        </div>
        
        <div class="modal-footer">
            <button id="yesButton" class="btn yes" type="button">Update & Refer to RHU</button>
            <button id="noButton" class="btn cancel">Update & Don't Refer</button>
            <button id="cancelBtn" class="btn cancel">Cancel</button>
        </div>

    </div>
</div>
 </div>

 <input type="hidden" name="referral_status" value="pending">

 <div id="myModal2" class="modal">
    <div class="modal-content">
        <div class="modal-header">
             <img src="../img/verify.png" alt="Checkmark" class="checkmark-image">
            <h3>Confirm</h3>
            <span class="close-btn" id="closeBtn2">&times;</span>
        </div>
        <div class="modal-body">
            <p>Do you confirm on updating patient consultation information?</p>
        </div>
        <div class="modal-footer">
            <button id="noButton2" class="btn no">No</button>
            <button id="yesButton2" class="btn yes" value="yes">Yes</button>
        </div>
    </div>
</div>

<div id="myModal3" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <img src="../img/check.png" alt="Checkmark" class="checkmark-image">
            <h3>Appointment Successful</h3>
            <span class="close-btn" id="closeBtn3" href="history.html">&times;</span>
        </div>

        <div class="modal-footer">
            <button id="viewDetailsButton" class="btn yes">View Details</button>
        </div>
    </div>
</div>

<div id="myModal4" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <img src="../img/check.png" alt="Checkmark" class="checkmark-image">
            <h3></h3>
            <span class="close-btn" id="closeBtn4" href="history.html">&times;</span>
        </div>
        <div class="modal-footer">
            <div class="modal-body">
                <div class="modal-header">
                    <h3 style="color: #033cad;">Record Successfully Updated</h3>
                </div>
                <div class="modal-footer">
                    <p></p>
            </div>
            </div>
        </div>
    </div>
</div> 

<div id="myModal5" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <img src="../img/verify.png" alt="Checkmark" class="checkmark-image">
            <h3>Record Successfully Updated</h3>
            <span class="close-btn" id="closeBtn5">&times;</span>
        </div>
        <div class="modal-body">
            <p>The patient record has been successfully added.</p>
        </div>
        <div class="modal-footer">
            <button id="exitButton" href="history.html" class="btn no">Exit</button>
        </div>
    </div>
</div>

<div id="referralExistsModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <img src="../img/warning.png" alt="Checkmark" class="checkmark-image">
            <h3>Referral already exists</h3>
            <span class="close-btn" id="closeBtn5">&times;</span>
        </div>
        <div class="modal-body">
            <p>Visit information are still successfully updated.</p>
        </div>
        <div class="modal-footer">
    <button id="cancelBtn2" class="btn cancel">Close</button>
</div>
</div>
</div>

<div id="logoutModal" class="logout-modal">
    <div class="logout-modal-content">
        <div class="logout-modal-header">
            <h3>Confirm Logout</h3>
        </div>
        <div class="logout-modal-body">
            <p>Are you sure you want to logout?</p>
        </div>
        <div class="logout-modal-footer">
            <button onclick="closeModal()" class="logout-cancel-btn">Cancel</button>
            <button onclick="proceedLogout()" class="logout-confirm-btn">Yes, Logout</button>
        </div>
    </div>
</div>

            <div class="form-container">
                <div class="print-section">
                    <button class="print-btn" id="printButton">Print</button>
                </div>
            </div>
      
    </div>

    <script>
        function confirmLogout() {
            document.getElementById('logoutModal').style.display = 'block';
            return false; // Prevent the default link behavior
        }
        
        function closeModal() {
            document.getElementById('logoutModal').style.display = 'none';
        }
        
        function proceedLogout() {
            window.location.href = '../role.html';
        }
        
        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('logoutModal');
            if (event.target == modal) {
                closeModal();
            }
        }
        fetch('php/getUserName.php')
            .then(response => response.json())
            .then(data => {
                if (data.full_name) {
                    document.getElementById('userGreeting').textContent = `Hello, ${data.full_name}!`;
                } else {
                    document.getElementById('userGreeting').textContent = 'Hello, BHW!';
                }
            })
            .catch(error => {
                console.error('Error fetching user name:', error);
                document.getElementById('userGreeting').textContent = 'Hello, BHW!';
            });

            	// Check if user is logged in
fetch('php/getUserId.php')
    .then(response => response.json())
    .then(data => {
        if (data.error) {
            // User is not logged in, redirect to role selection page
            window.location.href = '../role.html';
        }
    })
    .catch(error => {
        console.error('Error checking session:', error);
        window.location.href = '../role.html';
    });

        </script>
    
    <script src="js/editform.js"></script>
    <script src="js/script.js"></script>
    <script src="js/logout.js"></script>
    <script>
document.addEventListener("DOMContentLoaded", () => {
  const sidebar = document.getElementById("sidebar");

  function applyResponsiveSidebar() {
    if (window.innerWidth <= 1024) {
      sidebar.classList.add("hide");   // collapsed on small screens
    } else {
      sidebar.classList.remove("hide"); // expanded on larger screens
    }
  }

  applyResponsiveSidebar();
  window.addEventListener("resize", applyResponsiveSidebar);

  // keep the rest of your existing code (auth, stats, modals, etc.)
});
</script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  if (window.jQuery && $.fn.select2) {
    $('#diagnosis').select2({
      tags: true,
      width: '100%',
      placeholder: 'Select or type diagnosis',
      allowClear: true
    });
  }
});
</script>

</body>
</html>
