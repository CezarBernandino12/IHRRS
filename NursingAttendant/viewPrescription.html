<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="icon" href="../img/logo.png">
	<link href="https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css" rel="stylesheet">
	<link rel="stylesheet" href="css/form.css">
    <link rel="stylesheet" href="css/logout.css">
   
	<title>Issued Records</title> 


     <style>
    /* Basic styling (matches original look; adjust as needed) */

    .quarter-page {
      width: 100%;
      max-width: 420px; /* approximate quarter-page width */
      border: 1px solid transparent;
      padding: 12px;
      box-sizing: border-box;
    }

    .header {
      text-align: center;
      margin-left: 130px;
    }

    .print-logo {
      height: 50px;
      width: auto;
      display: inline-block;
    }

    h3 {
      margin: 4px 0;
      font-size: 16px;
      font-weight: 600;
    }

    p {
      margin: 0;
      font-size: 13px;
    }

    .info {
      margin: 6px 0;
      font-size: 14px;
    }

    .info .label {
      font-weight: 700;
      margin-right: 6px;
    }

    .section h2 {
      margin-top: 10px;
      margin-bottom: 8px;
      font-size: 18px;
    }

    .section img[alt="Rx"] {
      width: 50px;
      height: 50px;
      display: block;
      margin: 6px 0 12px 0;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
      margin-top: 6px;
    }

    table thead th {
      text-align: left;
      padding: 6px 8px;
      border-bottom: 1px solid #ccc;
      font-weight: 700;
    }

    table tbody td {
      padding: 6px 8px;
      border-bottom: 1px dashed #e0e0e0;
    }

    /* small print spacing for signature area */
    .signature {
      margin-bottom: -23px;
      margin-left: -17px;
      font-size: 13px;
    }

    /* Print friendly adjustments */
    @media print {
      body { margin: 0; }
      .quarter-page { box-shadow: none; border: none; padding: 8px; }
    }
  </style>

</head>
<body>

	<!-- Sidebar Section -->
	<section id="sidebar">
		<a href="#" class="brand">
			<img src="../img/logo.png" alt="RHULogo" class="logo">
			<span class="text">Hello Nurse</span>
		</a>
		<ul class="side-menu top">
			<li>
				<a href="dashboard.html">
					<i class="bx bxs-dashboard"></i>
					<span class="text">Dashboard</span>
				</a>
			</li>
            <li>
				<a href= "ITR.html">
					<i class="bx bxs-user"></i>
					<span class="text">Add New ITR</span>
				</a>
			</li>
			<li class="active">
                <a href="#" id="updateReferrals">
                    <i class="bx bxs-user"></i>
                    <span class="text">Pending Referrals</span>
                </a>
            </li>
            
            <script>
            document.getElementById("updateReferrals").addEventListener("click", function (event) {
                event.preventDefault(); // Prevent default navigation
            
                fetch("php/update_referrals.php") // Call PHP file
                .then(response => response.json())
                .then(data => {
                    console.log(data.message); // Log success message (optional)
                    window.location.href = "pending.html"; // Redirect after updating
                })
                .catch(error => {
                    console.error("Error updating referrals:", error);
                    window.location.href = "pending.html"; // Still redirect even if an error occurs
                });
            });
            </script>

            	<li>
				<a href="followUpConsultations.html">
					<i class="bx bxs-user"></i>
					<span class="text">Follow-Up Visits</span>
				</a>
			</li>
            
			<li>
				<a href="searchPatient.html">
					<i class="bx bxs-notepad"></i>
					<span class="text">Patient Records</span>
				</a>
			</li>
            <li>
                <a href="history.html">
                    <i class="bx bx-history"></i>
                    <span class="text">Referral History</span>
                </a>
            </li>
            <li>
				<a href="reports.html">
					<i class="bx bx-notepad"></i>
					<span class="text">Reports</span>
				</a>
			</li>
		</ul>
		<ul class="side-menu">
			<li>
				<a href="#" class="logout" onclick="return confirmLogout()">
               <i class="bx bxs-log-out-circle"></i>
                <span class="text">Logout</span>
                </a>
			</li>
		</ul>
	</section>

	<!-- Main Content Section -->
	<section id="content">
		<nav style="display: flex; justify-content: flex-end; align-items: center; gap: 10px;">
    <div class="greeting">
        <span id="userGreeting">Hello Nurse!</span>
    </div>
    <a href="#" class="profile">
        <img src="../img/nurse.png" alt="Profile" style="width: 40px; height: 40px; border-radius: 50%;">
    </a>
</nav> 



		<main>
            
            <div class="head-title">
                <div class="left">
                  <h1>Issued Records</h1>
                  <ul class="breadcrumb">
                    <li><a href="#">Issued Records</a></li>
                    <li><i class="bx bx-chevron-right"></i></li>
                    <li><a class="active" href="#">Home</a></li>
                  </ul>
                </div>
              </div>

<br>

            <div class="history-container" style="width: 600px;">
             
  <div class="quarter-page">
    <!-- Header section (replace placeholders) -->
    <div class="header">
      <img src="../img/RHUlogo.png" alt="RHU Logo" class="print-logo" />
      <h3>Republic of the Philippines</h3>
      <p style="margin-top: -5px; background-color: white;">Province of Camarines Norte</p>
      <h3 style="margin-top: -5px;">Municipality of Daet</h3>

      <div class="info">
        <span class="label"></span>
        <!-- REPLACE WITH RHU NAME, e.g., "RHU II - San Isidro" -->
        <span id="rhu-name">[RHU NAME]</span>
      </div>
      <br><br>
    </div>

    <!-- Section -->
    <div class="section">
      <h2>Prescription</h2> <br>

      <!-- Rx icon -->
      <img src="../img/rx.png" alt="Rx" style="width: 70px; height: auto;" /> <br>

      <!-- Patient info (replace placeholders) -->
      <div class="info"><span class="label">Patient:</span> <span id="patient-name">[LAST, FIRST M]</span></div>
      <div class="info"><span class="label">Address:</span> <span id="patient-address">[ADDRESS]</span></div>
      <div class="info">
        <span class="label">Age:</span> <span id="patient-age">[AGE]</span> |
        <span class="label">Sex:</span> <span id="patient-sex">[SEX]</span>
      </div>
      <div class="info"><span class="label">Consultation Date:</span> <span id="consultation-date">[YYYY-MM-DD]</span></div>
      <br>
      <!-- Prescribed medicines table -->
      <h5>Prescribed Medicines:</h5>
      <table>
        <thead>
          <tr>
            <th>Medicine Name</th>
            <th>Quantity</th>
            <th>Instruction</th>
          </tr>
        </thead>
        <tbody id="medicines-tbody">
          <!-- Example static row (replace or duplicate rows as needed) -->
          <tr>
            <td>Amoxicillin 500mg</td>
            <td>10</td>
            <td>Take 1 tablet every 8 hours</td>
          </tr>
          <!-- Add more rows dynamically or manually -->
        </tbody>
      </table> <br> <br>

       
      <div class="signature">
        <p style="background-color: white;"><small>Signature</small></p> <br> <br>
        <p style="background-color: white;">______________________________</p>
        
      </div>
     
      <div class="info"><span class="label">Physician:</span> <span id="physician-name">[PHYSICIAN NAME]</span></div>
      <div class="info"><span class="label">License No.:</span> <span id="physician-license">[LICENSE NO.]</span></div>

    
    </div>
  </div>


            </div>


  
<div id="logoutModal" class="logout-modal">
    <div class="logout-modal-content">
        <div class="logout-modal-header">
            <h3>Confirm Logout</h3>
        </div>
        <div class="logout-modal-body">
            <p>Are you sure you want to logout?</p>
        </div>
        <div class="logout-modal-footer">
            <button onclick="closeModal()" class="logout-cancel-btn">Cancel</button>
            <button onclick="proceedLogout()" class="logout-confirm-btn">Yes, Logout</button>
        </div>
    </div>
</div>  

	   </main>	
</section>

<script>
document.addEventListener("DOMContentLoaded", function() {
    // Get consultation_id from URL
    const urlParams = new URLSearchParams(window.location.search);
    const consultationId = urlParams.get("consultation_id");

    if (!consultationId) {
        alert("Missing consultation ID in URL.");
        return;
    }

    // Fetch data from PHP
    fetch(`php/get_prescription.php?consultation_id=${consultationId}`)
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                console.error("Error:", data.error);
                alert(data.error);
                return;
            }

            console.log("Fetched data:", data);

            const consultation = data.consultations[0];
            const prescriptions = data.prescriptions;

            // Populate fields
            document.getElementById("rhu-name").textContent = consultation.rhu || "N/A";
            document.getElementById("patient-name").textContent = consultation.patient_name || "N/A";
            document.getElementById("patient-address").textContent = consultation.address || "N/A";
            document.getElementById("patient-age").textContent = consultation.age || "N/A";
            document.getElementById("patient-sex").textContent = consultation.sex || "N/A";
            document.getElementById("consultation-date").textContent = consultation.consultation_date || "N/A";
            document.getElementById("physician-name").textContent = consultation.physician_name || "N/A";
            document.getElementById("physician-license").textContent = consultation.physician_license || "N/A";

            // Populate prescriptions table
            const tbody = document.getElementById("medicines-tbody");
            tbody.innerHTML = "";

            prescriptions.forEach(item => {
                const tr = document.createElement("tr");
                tr.innerHTML = `
                    <td>${item.medicine_name || ""}</td>
                    <td>${item.quantity || ""}</td>
                    <td>${item.instruction || ""}</td>
                `;
                tbody.appendChild(tr);
            });
        })
        .catch(err => {
            console.error("Fetch error:", err);
            alert("Failed to load data.");
        });
});


fetch('php/getUserName.php')
    .then(response => response.json())
    .then(data => {
        if (data.full_name) {
            document.getElementById('userGreeting').textContent = `Hello, ${data.full_name}!`;
        } else {
            document.getElementById('userGreeting').textContent = 'Hello, BHW!';
        }
    })
    .catch(error => {
        console.error('Error fetching user name:', error);
        document.getElementById('userGreeting').textContent = 'Hello, BHW!';
    }); 
    function confirmLogout() {
            document.getElementById('logoutModal').style.display = 'block';
            return false; // Prevent the default link behavior
        }
        
        function closeModal() {
            document.getElementById('logoutModal').style.display = 'none';
        }
        
        function proceedLogout() {
            window.location.href = '../ADMIN/php/logout.php'; 
        }
        
        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('logoutModal');
            if (event.target == modal) {
                closeModal();
            }
        } 
              // Check if user is logged in
              fetch('php/getUserId.php')
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    // User is not logged in, redirect to role selection page
                    window.location.href = '../role.html';
                }
            })
            .catch(error => {
                console.error('Error checking session:', error);
                window.location.href = '../role.html';
            });
</script>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const sidebar = document.getElementById("sidebar");

  function applyResponsiveSidebar() {
    if (window.innerWidth <= 1024) {
      sidebar.classList.add("hide");   // collapsed on small screens
    } else {
      sidebar.classList.remove("hide"); // expanded on larger screens
    }
  }

  applyResponsiveSidebar();
  window.addEventListener("resize", applyResponsiveSidebar);

  // keep the rest of your existing code (auth, stats, modals, etc.)
});
</script>
	<script src="js/script.js"></script>
    <script src="js/history.js"></script>
</body>
</html>



