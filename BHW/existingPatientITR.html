<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="../img/logo.png">
    <link href='https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="css/ITRexist.css">
    <link rel="stylesheet" href="css/logout.css">
    <title>Individual Treatment Record</title>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
</head>

<body>

<script>
// Check if user is logged in
fetch('php/getUserId.php')
    .then(response => response.json())
    .then(data => {
        if (data.error) {
            // User is not logged in, redirect to role selection page
            window.location.href = '../role.html';
        }
    })
    .catch(error => {
        console.error('Error checking session:', error);
        window.location.href = '../role.html';
    });
</script>

	<section id="sidebar">
		<a href="#" class="brand">
			<img src="../img/logo.png" alt="RHULogo" class="logo">
			<span class="text">IHRRS</span>
		</a>
		<ul class="side-menu top">
			<li>
				<a href="dashboard.html">
					<i class="bx bxs-dashboard"></i>
					<span class="text">Dashboard</span>
				</a>
			</li>
			<li class="active">
				<a href= "ITR.html">
					<i class="bx bxs-user"></i>
					<span class="text">Add New ITR</span>
				</a>
			</li>
			<li>
				<a href="searchPatient.html">
					<i class="bx bxs-notepad"></i>
					<span class="text">Patient Records</span>
				</a>
			</li>
			<li>
				<a href="history.html">
					<i class="bx bx-history"></i>
					<span class="text">Referral History</span>
				</a>
			</li>
            <li>
				<a href="reports.html">
					<i class="bx bx-notepad"></i>
					<span class="text">Reports</span>
				</a>
			</li>
		</ul>
		<ul class="side-menu">
			<li>
<a href="#" class="logout" onclick="return confirmLogout()">
               <i class="bx bxs-log-out-circle"></i>
                <span class="text">Logout</span>
                </a>			</li>
		</ul>
	</section>

    <section id="content">
        <nav>
            <form action="#">
             
            </form>
            <div class="greeting">
                <span id="userGreeting">Hello BHW!</span>
            </div>
            <a href="#" class="profile">
                <img src="../img/bhw.png">
            </a>
        </nav>

        <main>
            <div class="head-title">
				<div class="left">
					<h1>Add Individual Treatment Record</h1>
					<ul class="breadcrumb">
						<li><a href="#">Add ITR</a></li>
						<li><i class="bx bx-chevron-right"></i></li>
						<a class="active" href="#" onclick="history.back(); return false;">Go back</a>

					</ul>
				</div>
			</div>
        </main>
    </section>


    <!-- CONSENT Modal -->
<div class="custom-modal-backdrop" id="consentModal">
    <div class="custom-consent-box">
        <h3><b>PATIENT CONSENT FOR COLLECTION AND USE OF PERSONAL HEALTH INFORMATION</b></h3> <br>
         <h3><b>Basahin sa pasyente:</b></h3>
            <h4>
                 "Pumapayag ako, alinsunod sa Data Privacy Act of 2012, na itala ng health worker ang aking personal at medikal na impormasyon sa computer system upang ako ay mabigyan ng tamang gamutan at ma-refer kung kinakailangan. Naiintindihan ko na ang aking impormasyon ay gagamitin lamang para sa aking kalusugan at mananatiling pribado."
            </h4>
             <br>
             <div class="custom-consent-checkbox">
                <input type="checkbox" id="consentCheckbox">
                <label for="consentCheckbox">Nagbigay ng pahintulot ang pasyente (pasalita)</label>
            </div>
             <br>
                    <button id="declineBtn">Declined</button>
                    <button id="continueBtn" disabled>Agree and Continue</button>
    </div>
</div>
  
    <div class="container-header">

        <h2>INDIVIDUAL TREATMENT RECORD (ITR)</h2>
    </div>

    <div class="container">
       
        <p style="overflow: hidden; margin-bottom: 10px;">
            <b style="float: left;">PERSONAL INFORMATION:</b>
            <span style="float: right;">
              <span style="cursor: pointer; color: rgb(43, 68, 180);" id="toggleInfo">SEE LESS</span>
            
            </span>
          </p>
          
            
          <div class="form-container" id="infoSection">
        <!-- Row 1 -->
        <div class="form-group">
            <label for="last-name">Last Name:</label>
            <input type="text" class="patient-last-name form-control" name="last_name" value="N/A" disabled>
        </div>
        <div class="form-group">
            <label for="first-name">First Name:</label>
            <input type="text" class="patient-first-name form-control" name="first_name" value="N/A" disabled>
        </div>
        <div class="form-group">
            <label for="middle-name">Middle Name:</label>
            <input type="text" class="patient-middle-name form-control" name="middle_name" value="N/A" disabled>
        </div>

                <!-- Row 2 -->
                <div class="form-group">
                    <label for="birth-place">Birth Place:</label>
                    <input type="text" class="patient-birth-place form-control" name="birthplace" value="N/A" disabled>
                </div>
                <div class="form-group">
                    <label for="dob">Date of Birth:</label>
                    <input type="date" class="date-of-birth form-control" name="date_of_birth" disabled>
                </div>
                <div class="form-group">
                    <label for="age">Age:</label>
                    <input type="number" class="age form-control" name="age" value="N/A" disabled>
                </div>
            
        <!-- Row 3 -->
        <div class="form-group">
            <label for="address">Permanent Address:</label>
            <input type="text" class="address form-control" name="address" value="N/A" disabled>
        </div>
        <div class="form-group">
            <label for="civil-status">Civil Status:</label>
            <input type="text" class="civil-status form-control" name="civil_status" value="N/A" disabled>
        </div>
        <div class="form-group">
            <label for="mobile-number">Mobile Number:</label>
            <input type="text" class="contact-number form-control" name="contact_number" value="N/A" disabled>
        </div>
            

            
         <div class="form-group">
            <label>Religion:</label>
            <input type="text" class="religion form-control" name="religion" value="N/A" disabled>
        </div>
                
        <div class="form-group">
            <label>Occupation:</label>
            <input type="text" class="occupation form-control" name="occupation" value="N/A" disabled>
        </div>
            
                    <div class="form-group">
                        <label>Educational Attainment:</label>
                        <input type="text" class="educational-attainment form-control" name="educational_attainment" value="N/A" disabled>
                    </div>
                    <div class="form-group">
                        <label>Philhealth Member Number:</label>
                        <input type="text" class="philhealth-member-no form-control" name="philhealth_member_no" value="N/A" disabled>
                    </div>
                    <div class="form-group">
                        <label>Family Serial Number:</label>
                        <input type="text" class="family-serial-no form-control" name="family_serial_no" value="N/A" disabled>
                    </div>
            
                    <div class="form-group">
                        <label>Gender:</label>
                        <input type="text" class="sex form-control" name="sex" value="N/A" disabled>
                    </div>
                    <div class="form-group">
                        <label>4Ps Status:</label>
                        <input type="text" class="fourps-status form-control" name="fourps_status" value="N/A" disabled>
                    </div>
           

                <!-- Warning Section -->
                <div class="form-group full-width">
                    <div class="warning" id="warning" style="color: red; display: none;">
                        Patient already exists.
                    </div>
                </div>
            </div>


            <br> <br> <br>

            <form class="personal-info-form" id="individualRecordForm" action="php/saveInitialAssessment1.php" method="POST">
                <input type="hidden" name="form_type" value="individual_record">
    
            <p><b>PATIENT VISIT SUMMARY:</b></p>
            <div class="additional-group box-group additional-fields">
                <div class="additional-options">
                    
                    <div class="form-group"  style ="width: 200px;">
                        <label for="alert">Patient Alert:</label>
                        <select name="patient_alert" id="patient_alert">
                            <option value="">Select (if any)</option>
                            <option value="other">Other (Enter manually)</option>
                            <option value="Impairment">Impairment</option>
                            <option value="Allergic Reactions">Allergic Reactions</option>
                            <option value="Disability">Disability</option>
                            <option value="Drugs">Drugs</option>
                           
                        </select>
                    </div>
<br>
                      <div class="additonal-group"> 
                        <label for="dov" class="required">Date of Visit:</label>
                        <input type="date" name="dov" id="dov" required>
                    </div>
<script>
document.addEventListener("DOMContentLoaded", function () {
                     
    const today = new Date().toISOString().split('T')[0];
    document.getElementById("dov").value = today;

});</script>
                   

                     <!-- Do not remove -->
                  
                          <!-- Do not remove -->    <input type="hidden" name="user_id" id="user_id" hidden>

                          <script>
                            fetch('php/getUserId.php')
                              .then(response => response.json())
                              .then(data => {
                                if (data.user_id) { 
                                  document.getElementById("user_id").value = data.user_id;
                                } else {
                                  console.error("User not logged in.");
                                  // Optionally redirect to login
                                  // window.location.href = "BHWlogin.html";
                                }
                              })
                              .catch(error => console.error("Error fetching user ID:", error));
                          </script>

                    <div class="additonal-group">
                        <label for="chief_complaints" class="required">Chief Complaints:</label>
                        <textarea type="text" name="chief_complaints" class="tall-input" placeholder="Enter complaints" value="test"></textarea>
                    </div>

                    <label for="vitals"><b>Vital Signs:</b></label>
                    <div class="vitals-section box-group">
                        <div class="additional-group vitals-item">
                            <label for="bmi">BMI:</label>
                            <input type="number" step="any" name="bmi" id="bmi" placeholder="BMI will appear here" readonly>
                        </div>
                        <div class="additional-group" hidden>
                            <label for="space"></label>
                          
                        </div>
                        
                        <div class="additional-group vitals-item">
                            <label for="height" class="required">Height (cm):</label>
                            <input type="number" step="any" name="height" id="height" placeholder="Enter height (e.g, 160)" oninput="calculateBMI()" required>
                        </div>
                        
                        <div class="additional-group vitals-item">
                            <label for="weight" class="required">Weight (kg):</label>
                            <input type="number" step="any" name="weight" id="weight" placeholder="Enter weight (e.g, 50.2)" oninput="calculateBMI()" required>
                        </div>
                        
                        <div class="additional-group vitals-item">
                            <label for="temp" class="required">Temperature (°C):</label>
                            <input type="number" step="any" id="temp" name="temp" placeholder="Enter temperature (e.g, 38.2)" required>
                        </div>
                        
                        <div class="additional-group vitals-item">
                            <label for="bp" class="required">Blood Pressure (mm Hg):</label>
                            <input type="text" step="any" id="bp" name="bp" placeholder="Enter BP (e.g., 120/80)" required>
                        </div>
                       
                        
                        
                        <div class="additional-group vitals-item">
                            <label for="pr">Chest Rate (per min.):</label>
                            <input type="number" step="any" name="pr">
                        </div>
                      
                        <div class="additional-group vitals-item">
                            <label for="rr">Respiratory Rate (per min.):</label>
                            <input type="number" step="any" name="rr">
                        </div>
                    </div>

                    <div class="form-group">
                        <select id="diagnosis" name="diagnosis" hidden>
                            <option value="">Select Diagnosis</option>
                        </select>
                    </div>

                   
                </div>
            </div>

            <div class="form-group">
                <div class="form-group">
                    <label for="treatment">Treatment:</label>
                    <select id="treatment" name="treatment">
                        <option value="">Select treatment (if no referral)</option>
                        <option value="other">Other (Enter manually)</option>
                        <option value="Weighing only">Weighing only</option>
                        <option value="Immunization">Immunization</option>
                        <option value="BP only">BP only</option>
                       
                    </select>
                </div> <br>

                <div id="medicine-container">
                    <div class="medicine-entry" style="display: flex; gap: 10px; align-items: center;">
                        <div class="form-group" style="flex: 1;"> 
                            <label for="medicine_given[]">Medication Given:</label>
                            <select name="medicine_given[]" class="medicine-select" style="width: 200px;">
                                <option value="">Select</option>
                                <option value="other">Other (Enter manually)</option>
                                <option value="Paracetamol">Paracetamol</option>
                                <option value="Ibuprofen">Ibuprofen</option>
                                <option value="Amoxicillin">Amoxicillin</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="quantity_given[]">Quantity:</label>
                            <div class="quantity-container" style="display: flex; gap: 5px;">
                                <button type="button" class="btn-minus">−</button>
                                <input type="number" name="quantity_given[]" value="0" min="0" style="height: 17px;">
                                <button type="button" class="btn-plus">+</button>
                            </div>
                        </div>
                        <button type="button" class="btn-remove" style="margin-top: 25px; background-color: #e6e6e6; color: rgb(0, 0, 0); border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; height: 35px;">
                            Remove
                        </button>
                    </div>
                </div>
                
                <div class="add-medicine-container">
                    <button type="button" id="add-medicine" class="add-medicine">+ Add</button>
                </div>
                
                <script>
document.getElementById("add-medicine").addEventListener("click", function() {
    let container = document.getElementById("medicine-container");
    let newEntry = container.firstElementChild.cloneNode(true);
    
    // Reset values in the cloned elements
    newEntry.querySelector("select").value = "";
    newEntry.querySelector("input[type='number']").value = "0";
    
    // Append the new entry to the container
    container.appendChild(newEntry);

    // Scroll the form container to the bottom to prevent overlap
    container.scrollIntoView({ behavior: 'smooth', block: 'end' });
});

// Add remove button handler
document.addEventListener("click", function(event) {
    if (event.target.classList.contains("btn-remove")) {
        // Don't remove if it's the last entry
        if (document.querySelectorAll(".medicine-entry").length > 1) {
            event.target.closest(".medicine-entry").remove();
        } else {
            alert("Cannot remove the last medicine entry.");
        }
    } else if (event.target.classList.contains("btn-plus")) {
        let input = event.target.previousElementSibling;
        input.value = parseInt(input.value) + 1;
    } else if (event.target.classList.contains("btn-minus")) {
        let input = event.target.nextElementSibling;
        if (parseInt(input.value) > 0) {
            input.value = parseInt(input.value) - 1;
        }
    }
});
                </script>
                
            </div>
            
            <div class="form-group">
                <label for="remarks">Remarks:</label>
                <textarea type="text" name="remarks" class="tall-input" placeholder="Enter Remarks" value="test"></textarea>
            </div>

            <input type="hidden" name="consent_given" id="consent_given" value="COLLECTION AND USE OF PERSONAL HEALTH INFORMATION">
            <input type="hidden" name="consent_method" id="consent_method" value="verbal">

        <div class="form-container">
            <div class="print-section">
            </div>

            <input type="hidden" id="patient_id" name="patient_id">
            <input type="hidden" id="referral_needed" name="referral_needed">
        
            <div class="button-container">
                <button type="submit" class="submit-btn" id="submitButton">Submit</button>
            </div>
            
        </form>
        
            <div id="myModal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <img src="../img/verify.png" alt="Checkmark" class="checkmark-image">
                        <h3>Confirmation</h3>
                        <span class="close-btn" id="closeBtn">&times;</span>
                    </div>
                    <div class="modal-body">
                        <p>Refer the Patient to RHU? </p> 
                    </div>
                    
                    <div class="modal-footer">
                        <button id="yesButton" class="btn yes" type="button">Save, refer to RHU</button>
                        <button id="noButton" class="btn maybe" type="button">Save, don't refer</button>
                        <button id="cancelBtn" class="btn cancel">Cancel</button>
                    </div>

                </div>
            </div>
             </div>

             <input type="hidden" name="referral_status" value="pending">

             <div id="myModal2" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                         <img src="../img/verify.png" alt="Checkmark" class="checkmark-image">
                        <h3>Confirm</h3>
                        <span class="close-btn" id="closeBtn2">&times;</span>
                    </div>
                    <div class="modal-body">
                        <p>Do you confirm on referring this patient?</p>
                    </div>
                    <div class="modal-footer">
                        <button id="noButton2" class="btn no">No</button>
                        <button id="yesButton2" class="btn yes" value="yes">Yes</button>
                    </div>
                </div>
            </div>

            <div id="myModal3" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <img src="../img/check.png" alt="Checkmark" class="checkmark-image">
                        <span class="close-btn" id="closeBtn3">&times;</span>
                    </div>
                    <div class="modal-footer">
                        <div class="modal-header">
                            <h3 style="color: #033cad;">Referral Sent to RHU!</h3>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button id="viewDetailsButton" class="btn yes">PRINT REFERRAL SLIP</button>
                    </div>
                </div>
            </div>
        
            <div id="myModal4" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <img src="../img/success.png" alt="Checkmark" class="checkmark-image">
                        <h3></h3>
                        <span class="close-btn" id="closeBtn4">&times;</span>
                    </div>
                    <div class="modal-footer">
                        <div class="modal-body">
                            <p>Record successfully added.</p>
                        </div>
                    </div>
                </div>
            </div> 
            
            <div id="myModal5" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <img src="../img/verify.png" alt="Checkmark" class="checkmark-image">
                        <h3>Record Added</h3>
                        <span class="close-btn" id="closeBtn5">&times;</span>
                    </div>
                    <div class="modal-body">
                        <p>The patient record has been successfully added.</p>
                    </div>
                    <div class="modal-footer">
                        <button id="exitButton" class="btn yes">Exit</button>
                    </div>
                </div>
            </div>







        

             <div id="successMessage" style="display: none; color: green;">
                Patient information successfully saved!
            </div>
            
            <!-- Error Message -->
            <div id="errorMessage" style="display: none; color: red;">
                Error saving data.
            </div>
            <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
          


<script>
      
      
      document.addEventListener("DOMContentLoaded", function() {
            // Get patient_id from the URL
            const urlParams = new URLSearchParams(window.location.search);
            const patient_id = urlParams.get("patient_id");

          if (patient_id) {
          fetch(`php/patient_details.php?patient_id=${patient_id}`)
              .then(response => {
                  // Check if the response is OK (status 200-299)
                  if (!response.ok) {
                      throw new Error(`HTTP error! Status: ${response.status} - ${response.statusText}`);
                  }
                  return response.text(); // Get raw response as text first
              })
              .then(responseText => {
                  console.log("Raw response:", responseText); // Log raw response to debug
      
                  try {
                      // Try parsing the response as JSON
                      const data = JSON.parse(responseText);
                      console.log("Received Data:", data); // ✅ Debugging
      
                      if (!data || data.error) {
                          console.error("Error:", data.error || "No data received.");
                          return;
                      }
      
      
                      // ✅ Populate Patient Information
                      if (data.patient) {
                          populateInput(".patient-first-name", data.patient.first_name);
                          populateInput(".patient-last-name", data.patient.last_name);
                          populateInput(".patient-middle-name", data.patient.middle_name);
                          populateInput(".patient-birth-place", data.patient.birthplace);
                          populateInput(".date-of-birth", data.patient.date_of_birth, "date");
      
                          // Calculate age
                          const age = calculateAge(data.patient.date_of_birth);
                          populateInput(".age", age);
      
                          populateInput(".address", data.patient.address);
                          populateInput(".civil-status", data.patient.civil_status);
                          populateInput(".contact-number", data.patient.contact_number);
                          populateInput(".religion", data.patient.religion);
                          populateInput(".occupation", data.patient.occupation);
                          populateInput(".educational-attainment", data.patient.educational_attainment);
                          populateInput(".philhealth-member-no", data.patient.philhealth_member_no);
                          populateInput(".family-serial-no", data.patient.family_serial_no);
                          populateInput(".sex", data.patient.sex);
                          populateInput(".fourps-status", data.patient.fourps_status);
                      }
                  } catch (e) {
                      // Error parsing JSON or unexpected response structure
                      console.error("Error parsing JSON:", e);
                      alert("Response was not valid JSON. See console for details.");
                  }
              })
              .catch(error => {
                  // Catch network errors or other unexpected issues
                  console.error("Error fetching visit info:", error);
                  alert("An error occurred while fetching the visit info. See console for details.");
              });
      }
      
      
          // ✅ Function to update input values
          function populateInput(selector, value, type = "text") {
              const element = document.querySelector(selector);
              if (element) {
                  if (element.tagName === "INPUT" || element.tagName === "TEXTAREA") {
                      if (type === "date" && value) {
                          element.value = formatDate(value);
                      } else {
                          element.value = value || "";
                      }
                  }
              }
          }
      
          function formatDate(dateString) {
              if (!dateString) return "";
              const date = new Date(dateString);
              return isNaN(date) ? "" : date.toISOString().split("T")[0];
          }
      
          function calculateAge(dob) {
              if (!dob) return "N/A";
              const birthDate = new Date(dob);
              if (isNaN(birthDate)) return "N/A";
      
              const today = new Date();
              let age = today.getFullYear() - birthDate.getFullYear();
              const monthDiff = today.getMonth() - birthDate.getMonth();
      
              if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                  age--;
              }
      
              return age >= 0 ? age : "N/A";
          }
      
        // ✅ Save Button Functionality

      
      
      });





      function calculateBMI() {
                const heightInput = document.getElementById('height').value;
                const weightInput = document.getElementById('weight').value;
                const bmiField = document.getElementById('bmi');
            
                const height = parseFloat(heightInput);
                const weight = parseFloat(weightInput);
            
                if (height > 0 && weight > 0) {
                    // Convert height from cm to meters
                    const heightInMeters = height / 100;
                    const bmi = weight / (heightInMeters * heightInMeters);
                    bmiField.value = bmi.toFixed(2);
                } else {
                    bmiField.value = '';
                }
            }
            
            const addressSelect = document.getElementById('permanent_address');
const religionSelect = document.getElementById('religion');
const extensionSelect = document.getElementById('extension');
const medicineSelects = document.querySelectorAll('.medicine-select');
const treatmentSelect = document.getElementById('treatment');
const patientAlertSelect = document.getElementById('patient_alert');

// Helper to load options from DB
function loadCustomOptions(selectElement, category) {
    fetch(`php/get_custom_options.php?category=${category}`)
        .then(response => response.json())
        .then(options => {
            const existingValues = Array.from(selectElement.options).map(opt => opt.value);

            // Add options from DB only if not already in the select
            options.forEach(optionValue => {
                if (!existingValues.includes(optionValue)) {
                    const option = new Option(optionValue, optionValue);
                    selectElement.appendChild(option);
                }
            });

            // If "other" isn't already there, add it
            if (!existingValues.includes("other")) {
                selectElement.appendChild(new Option("Other (Enter manually)", "other"));
            }
        })
        .catch(error => console.error('Error fetching options:', error));
}


// Save custom value to DB
function saveCustomOption(category, value) {
    return fetch('php/save_custom_option.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: `category=${encodeURIComponent(category)}&value=${encodeURIComponent(value)}`
    }).then(response => response.json());
}

// Handler for "Other" input logic
function handleOtherSelection(selectElement, category, promptLabel) {
    selectElement.addEventListener("change", function () {
        if (this.value === "other") {
            const userInput = prompt(`Enter ${promptLabel}:`);
            if (userInput) {
                const exists = Array.from(this.options).some(opt => opt.value === userInput);
                if (!exists) {
                    const newOption = new Option(userInput, userInput, true, true);
                    this.appendChild(newOption);
                }
                this.value = userInput;

                saveCustomOption(category, userInput)
                    .then(data => {
                        if (!data.success) {
                            console.error(`Failed to save ${promptLabel}.`);
                        }
                    })
                    .catch(error => console.error('Error:', error));
            } else {
                this.value = "";
            }
        }
    });
}

// Apply handlers for each dropdown

handleOtherSelection(treatmentSelect, 'treatment', 'treatment');
handleOtherSelection(patientAlertSelect, 'patient_alert', 'patient alert');

medicineSelects.forEach(select => {
    handleOtherSelection(select, 'medicine', 'medicine name (dosage)');
});

// Load options on page load

loadCustomOptions(treatmentSelect, 'treatment');
loadCustomOptions(patientAlertSelect, 'patient_alert');
medicineSelects.forEach(select => {
    loadCustomOptions(select, 'medicine');
});




// For medicine-selects, you can loop each one
medicineSelects.forEach(select => loadCustomOptions(select, 'medicine'));
                                 
                                    document.querySelectorAll('label.required').forEach(function (label) {
                    const inputId = label.getAttribute('for');
                    const input = document.getElementById(inputId);
            
                    if (input) {
                        input.addEventListener("input", function () {
                            if (input.value.trim() !== "") {
                                label.classList.remove("required");
                            } else {
                                label.classList.add("required");
                            }
                        });
                    }
                });
      
   
  const toggleBtn = document.getElementById("toggleInfo");
  const editBtn = document.getElementById("editInfo");
  const infoSection = document.getElementById("infoSection");
  let isHidden = false;

  toggleBtn.addEventListener("click", function () {
    isHidden = !isHidden;
    if (isHidden) {
      infoSection.style.visibility = "hidden";
      infoSection.style.height = "0";
      infoSection.style.overflow = "hidden";
    } else {
      infoSection.style.visibility = "visible";
      infoSection.style.height = "auto";
      infoSection.style.overflow = "visible";
    }
    toggleBtn.textContent = isHidden ? "SEE MORE" : "SEE LESS";
  });

  editBtn.addEventListener("click", function () {
    const inputs = infoSection.querySelectorAll("input");
    const isDisabled = inputs[0].disabled;

    inputs.forEach(input => {
      input.disabled = !isDisabled;
    });

    editBtn.textContent = isDisabled ? "DONE" : "EDIT";
  });



</script>
    
    <script src="js/form1.js"></script>
    <script src="js/script.js"></script>
    <script src="js/modal.js"></script>

<div id="logoutModal" class="logout-modal">
    <div class="logout-modal-content">
        <div class="logout-modal-header">
            <h3>Confirm Logout</h3>
        </div>
        <div class="logout-modal-body">
            <p>Are you sure you want to logout?</p>
        </div>
        <div class="logout-modal-footer">
            <button onclick="closeModal()" class="logout-cancel-btn">Cancel</button>
            <button onclick="proceedLogout()" class="logout-confirm-btn">Yes, Logout</button>
        </div>
    </div>
</div>    

<script>
function confirmLogout() {
    document.getElementById('logoutModal').style.display = 'block';
    return false; // Prevent the default link behavior
}

function closeModal() {
    document.getElementById('logoutModal').style.display = 'none';
}

function proceedLogout() {
		 window.location.href = '../ADMIN/php/logout.php';
}

// Close modal when clicking outside
window.onclick = function(event) {
    const modal = document.getElementById('logoutModal');
    if (event.target == modal) {
        closeModal();
    }
}
fetch('php/getUserName.php')
    .then(response => response.json())
    .then(data => {
        if (data.full_name) {
            document.getElementById('userGreeting').textContent = `Hello, ${data.full_name}!`;
        } else {
            document.getElementById('userGreeting').textContent = 'Hello, BHW!';
        }
    })
    .catch(error => {
        console.error('Error fetching user name:', error);
        document.getElementById('userGreeting').textContent = 'Hello, BHW!';
    });
</script>
</body>
</html>
